# 洗衣机算法设计
>洗衣机的算法设计可以作为Top-down design的一个生动例子

## 什么是Top-down design？
自顶向下的方法（也被称为分步设计）本质上是对系统的破坏，以逆向工程的方式深入了解其子系统的组成。在自上而下的方法中，系统本身只给出一个行为或结果，但不详细说明任何第一级子系统。然后，每个子系统都会更详细地进行细化，有时在许多其他子系统级别中进行细化，直到整个规范缩减为基本元素。自上而下的模型通常在“黑匣子”的帮助下指定，这使得操作更容易。但是，黑匣子可能无法澄清基本机制或足够详细以实际验证模型。自上而下的方法始于全局。它从那里分解成更小的部分。

在我看来TOP-down 设计更像是一种思维方式。它将一个复杂行为从结果不断倒推，来推算子系统的行为，每一层的行为之间是逻辑关联的，很多个子系统的行为共同导致了母系统的判断。直到推演到最单一的动作行为。

比如以人们判断“这是猫”为例。这是最终的结果，人们分布设计让计算机也能认出猫的话。要分解“这是猫”的判断为“4条腿，动物”进而到“披着毛发，有四肢，有尖耳朵，有胡须”等等，最后将猫的形象分解为最基本的图形甚至是曲线。比如“尖耳朵”成为“一定弧度曲线围成的类三角”而我们可以用数学方式表现曲线的参数，这样就可以将“认识猫”的任务分解为计算机能做的问题。这就是一个Top-down design。

# 洗衣机的具体例子
>让我们回到洗衣机上，我们将用由几个洗衣机基本行为组成的伪代码来表示洗衣机的动作过程。

首先，根据TOP-down原则，我们先将洗衣机的行为“洗衣”细分一下
```
我们可以分为一下中级步骤：

READ 洗衣模式 ，浸泡时间 ，甩动时间，设定水量，报错时间（一个操作执行超过该时间说明存在故障）
注水
浸泡
甩动
脱水
二次注水
甩动
脱水
甩干

这些行为。

我们再将洗衣机的行为分为更基本的比如按钮的开关，计时等。

我们假设洗衣机可执行的基本操作如下

water_in_switch(open或close) // open 打开上水开关，close关闭

water_out_switch(open或close) // open 打开排水开关，close关闭

get_water_volume() //返回洗衣机内部水的高度

motor_run(direction) // 电机转动。left左转，right右转，stop停

time_counter() // 返回当前时间计数，以秒为单位

halt(returncode) //停机

success 成功 failure 失败

我们再考虑将我们的中级步骤分解为基本行为。

其中比较特别的是注水与脱水时考虑到也许会出现管道堵塞的情况，我们要加入一个报错时间（timeout）如果超过这个时间还没完成操作那么就停机，避免对机器造成损耗。

注水：{
    water_in_switch(open)
    REPEAT
        time_counter(时间)
        IF 时间>=报错时间
            halt
        END IF    
        get_water_volume(水量)
    UNTIL 水量>=设定水量
    water_in_switch(close)
}

浸泡{
    REPEAT
    time_counter(时间)
    UNTIL 时间>=浸泡时间
}

脱水{
    water_out_switch(open)
    REPEAT
        time_counter(时间)
        IF 时间>=timeout
            halt
        END IF    
        get_water_volume(水量)
    UNTIL 水量=0
    water_out_switch(close)
}
    
甩动{
    REPEAT
        motor_run(left)
        motor_run(right)
        time_counter(时间)
    UNTIL 时间>=甩动时间
    moter_run(stop)
} 

其中甩干与甩动相同，注水与再次注水一样。

这样我们就可以用这几个基本行为表现洗衣机的工作过程。